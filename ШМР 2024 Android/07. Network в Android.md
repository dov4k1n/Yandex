- [Лекция по сетевому взаимодействию в Android](#лекция-по-сетевому-взаимодействию-в-android)
  - [Введение](#введение)
  - [Почему мобильным разработчикам важно знать о сетевых взаимодействиях?](#почему-мобильным-разработчикам-важно-знать-о-сетевых-взаимодействиях)
  - [Основы сетевого взаимодействия: модель TCP/IP](#основы-сетевого-взаимодействия-модель-tcpip)
  - [Адресация и порты](#адресация-и-порты)
  - [Протоколы транспортного уровня](#протоколы-транспортного-уровня)
  - [Рукопожатие TCP и TLS](#рукопожатие-tcp-и-tls)
  - [Оптимизация сетевого взаимодействия](#оптимизация-сетевого-взаимодействия)
  - [Протоколы HTTP](#протоколы-http)
  - [Сериализация данных](#сериализация-данных)
  - [Проектирование API](#проектирование-api)
  - [Инструменты для работы с API](#инструменты-для-работы-с-api)
  - [Кэширование и авторизация](#кэширование-и-авторизация)
  - [Заключение](#заключение)


# Лекция по сетевому взаимодействию в Android

## Введение
00:00:53 — **Приветствие и представление**  
Василий Шумилов, архитектор Android Яндекс Музыки, представляет лекцию о сетевом взаимодействии в Android. Материал адаптирован для текущей школы и должен быть полезен для слушателей. 

00:01:23 — **Формат лекции**  
Лекция продлится до полутора часов с двумя паузами для вопросов: одна в середине и одна в конце. Задавать вопросы можно через ссылку на Aha Slides, указывая номер слайда для удобства ответа.

---

## Почему мобильным разработчикам важно знать о сетевых взаимодействиях?
00:02:14 — **Значимость знаний**  
Качество сетевого взаимодействия напрямую влияет на качество приложений. Пользователи расстраиваются из-за долгой загрузки или ошибок. Высокое качество приводит к лучшим оценкам и большему количеству пользователей.

00:03:05 — **Ограничения мобильных устройств**  
Мобильные устройства работают в условиях ограниченных ресурсов:
- Батарея быстро разряжается при интенсивном использовании сети.
- Задержки передачи данных могут сильно варьироваться (от 30 мс до 3000 мс).
- Пакеты часто теряются из-за плохого сигнала.
- Трафик обычно ограничен и дорог в некоторых регионах.

---

## Основы сетевого взаимодействия: модель TCP/IP
00:04:32 — **Что такое TCP/IP?**  
Модель TCP/IP описывает концептуальные уровни сетевого взаимодействия и правила поведения протоколов на каждом уровне:
1. **Уровень приложения**: Обеспечивает связь между приложениями (например, HTTP-запросы).  
2. **Транспортный уровень**: Обеспечивает связь между хостами (например, TCP или UDP).  
3. **Интернет-уровень**: Обеспечивает взаимодействие между независимыми сетями.  
4. **Канальный уровень**: Передает данные внутри одного канала (например, Wi-Fi или LTE).

00:07:15 — **Влияние канального уровня**  
На мобильных устройствах канальный уровень особенно важен, так как определяет скорость и надежность передачи данных (4G, LTE, 3G, 2G и др.).

---

## Адресация и порты
00:07:45 — **IPv4 и IPv6**  
- IPv4 использует 32-битные адреса (до 4 миллиардов устройств).  
- IPv6 использует 128-битные адреса, что позволяет адресовать значительно больше устройств.  

00:08:26 — **Порты**  
Порты используются для идентификации конкретных приложений на одном устройстве. Например:
- HTTP использует порт 80.  
- HTTPS использует порт 443.

00:08:46 — **DNS**  
DNS преобразует доменные имена (например, `yandex.ru`) в IP-адреса, упрощая работу пользователей.

---

## Протоколы транспортного уровня
00:09:48 — **TCP**  
TCP — надежный протокол, обеспечивающий последовательную доставку данных через разделение на пакеты и подтверждение их получения. Однако он требует дополнительных накладных расходов.

00:10:34 — **UDP**  
UDP — более простой протокол без гарантий доставки. Он используется в играх и других приложениях, где скорость важнее надежности.

---

## Рукопожатие TCP и TLS
00:11:02 — **Рукопожатие TCP**  
Процесс установления соединения занимает три посылки, но может быть оптимизирован до двух за счет отправки данных вместе с третьей посылкой.

00:11:27 — **TLS-рукопожатие**  
TLS обеспечивает безопасное соединение, но требует шести посылок, что увеличивает задержку.

---

## Оптимизация сетевого взаимодействия
00:12:25 — **Переиспользование соединений**  
Создание нового соединения затратно, поэтому важно переиспользовать существующие. Например, в Android Яндекс.Музыки это помогло снизить количество соединений для параллельных запросов.

00:13:41 — **Библиотеки для работы с сетью**  
OKHTTP — популярная библиотека для работы с сетью. Она имеет connection pool, который по умолчанию кэширует пять соединений на пять минут. Эти параметры можно настроить под свои нужды.

---

## Протоколы HTTP
00:15:24 — **HTTP/1.1**  
Протокол допускает последовательную передачу запросов через одно соединение. Поддерживает методы GET, POST, PUT, DELETE и другие.

00:17:51 — **HTTP/2**  
HTTP/2 вводит мультиплексирование, сжатие заголовков и бинарный формат передачи данных. Это улучшает производительность, но делает протокол зависимым от стабильности сети.

00:24:15 — **HTTP/3**  
HTTP/3 основан на протоколе QUIC, работающем поверх UDP. Он решает проблему head-of-line blocking и лучше работает в сетях с потерями пакетов. Однако его поддержка еще не普及рирована.

---

## Сериализация данных
00:38:31 — **JSON**  
JSON — текстовый формат, легкий для чтения и использования. Однако он менее эффективен по сравнению с другими форматами.

00:40:56 — **Protobuf**  
Protobuf — бинарный формат с жестко определенной схемой данных. Он компактнее JSON и быстрее сериализуется, но сложнее для чтения человеком.

---

## Проектирование API
00:44:11 — **REST, RPC и GraphQL**  
- REST — наиболее распространенный подход, основанный на HTTP-методах.  
- RPC и gRPC — позволяют выполнять удаленные вызовы функций и поддерживают стриминг.  
- GraphQL — позволяет клиентам запрашивать только необходимые данные.

---

## Инструменты для работы с API
00:48:00 — **OKHTTP и Retrofit**  
Retrofit упрощает работу с API, позволяя описывать запросы через аннотации. Он интегрируется с OKHTTP для управления сетевыми запросами.

00:52:14 — **gRPC**  
gRPC — мощный протокол, основанный на Protobuf. Он поддерживает стриминг и хорошо работает с современными сетями, но имеет высокий порог входа.

---

## Кэширование и авторизация
01:12:30 — **Кэширование**  
Кэширование помогает снизить количество запросов к серверу, если данные долго не меняются. Настройка доступна через OKHTTP или Ktor.

01:13:23 — **Аутентификация и авторизация**  
Basic Auth — простой способ передачи логина и пароля, но небезопасный. OAuth 2.0 — более современный и безопасный протокол.

---

## Заключение
01:13:46 — **Подведение итогов**  
Лекция охватила ключевые аспекты сетевого взаимодействия в Android, включая протоколы, библиотеки и методологии оптимизации. Автор рекомендует использовать современные технологии, такие как HTTP/2, Protobuf и Ktor, для создания качественных приложений.

--- 

Если остались вопросы, задавайте их через Aha Slides или пишите спикеру в Telegram.